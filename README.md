# 연구실 자리 배정 시스템 (보안 강화 버전) 🔐

대학원 연구실 석사/박사 과정 학생들의 자리 신청 및 배정을 자동화하는 **보안 강화** 웹 애플리케이션입니다.

## 🔒 보안 강화 사항 (2024.11)

### 1. 비밀번호 기반 인증 시스템
- **기존**: 학번 + 이름만으로 로그인 (타인 정보 악용 가능)
- **개선**: bcrypt 해시화된 비밀번호 필수 인증
- **초기 비밀번호**: 모든 사용자에게 "sg1234" 자동 할당
- **비밀번호 변경**: 메인 페이지에서 즉시 변경 가능

### 2. Authorization 헤더 기반 토큰 저장
- **기존**: localStorage에 JWT 토큰 저장 (XSS 공격 취약)
- **변경**: 클라이언트에서 토큰을 보관하고 모든 요청에 `Authorization` 헤더로 전달
- **쿠키 의존성 제거**: Safari 등에서의 제약 해결

### 3. 서버 기반 인증 확인
- **기존**: 클라이언트에서 localStorage 토큰 확인
- **개선**: `/auth/me` API로 서버에서 인증 상태 확인
- **토큰 무효화**: 로그아웃 시 클라이언트 토큰 제거
- **세션 보안**: 서버 검증을 통한 안전한 세션 관리

### 4. 민감정보 로깅 제거
- **기존**: 모든 환경에서 상세 로그 출력
- **개선**: 프로덕션에서 민감정보 로깅 완전 차단
- **DB 연결 정보**: 마스킹 처리
- **사용자 정보**: 개발환경에서만 출력

### 5. UI/UX 개선
- **생년월일 필드 제거**: 사용자 편의성 향상
- **간편 로그인**: 학번 + 비밀번호로 간소화
- **비밀번호 변경 모달**: 메인 페이지에 통합
- **즉시 UI 업데이트**: 로그아웃 시 상태 즉시 반영

## 🛠 기술 스택

### 백엔드
- **Node.js** + **Express.js**
- **MongoDB** (MongoDB Atlas)
- **JWT** 인증 (Authorization 헤더 사용)
- **bcryptjs** 비밀번호 해시화
- **CORS** 보안 설정
- **File Upload** (multer)

### 프론트엔드
- **Next.js**
- **React**
- **TailwindCSS**
- **Axios**
- **React Icons**
- **React Toastify**

## 🚀 배포

- **프론트엔드**: Vercel
- **백엔드**: CloudType
- **데이터베이스**: MongoDB Atlas

## 🏗 프로젝트 구조

```
seat-management/
├── backend/                # Express.js 백엔드
│   ├── controllers/        # API 컨트롤러들
│   │   ├── admin.js        # 관리자 기능 (통계, 사용자 관리, 좌석 관리)
│   │   ├── auth.js         # 인증 관련 (비밀번호 변경, 로그아웃 포함)
│   │   ├── seats.js        # 좌석 배정 로직
│   │   └── timeslots.js    # 시간 슬롯 관리
│   ├── middleware/         # 미들웨어 함수들
│   │   └── auth.js         # JWT 인증 미들웨어 (헤더)
│   ├── models/             # MongoDB 모델들
│   │   ├── AdminInfo.js    # 관리자 정보 모델
│   │   ├── Seat.js         # 좌석 모델
│   │   ├── TimeSlot.js     # 시간 슬롯 모델
│   │   └── User.js         # 사용자 모델 (비밀번호 필드 추가)
│   ├── routes/             # API 라우트들
│   ├── scripts/            # 데이터베이스 스크립트들
│   ├── .env                # 환경 변수 설정
│   ├── package.json        # 의존성 관리
│   └── server.js           # 서버 진입점 (보안 로깅)
│
└── frontend/               # Next.js 프론트엔드
    ├── components/         # 재사용 가능한 컴포넌트들
    │   ├── AdminNav.js     # 관리자 네비게이션
    │   ├── Footer.js       # 푸터
    │   ├── Header.js       # 헤더 (즉시 상태 업데이트)
    │   ├── Layout.js       # 레이아웃 래퍼
    │   └── SeatGrid.js     # 좌석 배치도
    ├── pages/              # 페이지 컴포넌트들
    │   ├── admin/          # 관리자 페이지들
    │   │   ├── index.js    # 관리자 대시보드
    │   │   ├── info.js     # 관리자 정보 관리
    │   │   ├── seats.js    # 좌석 관리 (3탭 구조)
    │   │   ├── timeslots.js # 시간 슬롯 관리
    │   │   └── users.js    # 사용자 관리 (초기 비밀번호 안내)
    │   ├── _app.js         # 앱 초기화
    │   ├── index.js        # 메인 페이지 (비밀번호 변경 모달)
    │   └── login.js        # 로그인 페이지 (비밀번호 필드)
    ├── public/             # 정적 파일들
    ├── styles/             # CSS 스타일
    ├── utils/              # 유틸리티 함수들
    │   ├── api.js          # API 호출 함수들 (헤더 인증)
    │   ├── auth.js         # 인증 관련 함수들 (서버 확인)
    │   ├── client-only.js  # 클라이언트 전용 컴포넌트
    │   └── timeUtils.js    # 시간 계산 유틸리티
    ├── .env.local          # 환경 변수 설정
    └── package.json        # 의존성 관리
```

## ⚙️ 설치 및 실행

### 사전 요구사항
- Node.js 16 이상
- npm 또는 yarn
- MongoDB 접속 정보

### 백엔드 설정
1. 백엔드 디렉토리로 이동
```bash
cd seat-management/backend
```

2. 의존성 설치
```bash
npm install
```

3. `.env` 파일 생성 및 환경 변수 설정
```
PORT=5001
MONGO_URI=<your_mongodb_connection_string>
JWT_SECRET=<your_jwt_secret_key_minimum_32_chars>
JWT_EXPIRE=30d
JWT_COOKIE_EXPIRE=30
NODE_ENV=development
```

4. 서버 실행
```bash
npm run dev
```

### 프론트엔드 설정
1. 프론트엔드 디렉토리로 이동
```bash
cd seat-management/frontend
```

2. 의존성 설치
```bash
npm install
```

3. `.env.local` 파일 생성 및 환경 변수 설정
```
NEXT_PUBLIC_API_URL=http://localhost:5001/api
```

4. 개발 서버 실행
```bash
npm run dev
```

## 📋 주요 기능

### 사용자 (학생)
- **🔐 보안 로그인**: 학번/수험번호 + 비밀번호 인증
- **🗝️ 비밀번호 변경**: 메인 페이지에서 즉시 변경 가능
- **⚡ 우선순위별 접근 제어**: 1~12순위별 차등 시간 배정
  - 1순위(수료생), 12순위(기타): 15:00부터 배정 종료까지
  - 2~11순위: 개별 배정 시간 + 15:00 이후 추가 접근
- **🗺️ 실시간 좌석 배치도**: 501~510호 연구실 좌석 현황 확인
- **🪑 좌석 신청/취소**: 클릭 한 번으로 간편한 좌석 관리
- **🔒 안전한 세션**: Authorization 헤더 기반 토큰 검증

### 관리자
#### 📊 대시보드
- **종합 통계**: 사용자 수, 좌석 현황, 배정률, 확정률
- **좌석 유형별 현황**: 석사/박사과정 좌석 분류
- **방별 배정 현황**: 501~510호 각 방별 상세 통계

#### 🪑 좌석 관리 (3탭 구조)
- **좌석 배치도**: 시각적 좌석 그리드, 실시간 상태 확인
- **신청 좌석 확정**: 일괄 확정 기능 (전체/방별/선택적)
- **좌석 목록 관리**: 테이블 형태 좌석 관리, Excel 다운로드

#### 👥 사용자 관리
- **🔐 초기 비밀번호**: 모든 사용자에게 "sg1234" 자동 할당
- **CSV 일괄 업로드**: 드래그앤드롭으로 사용자 대량 등록
- **템플릿 다운로드**: 한글 인코딩 지원 CSV 템플릿
- **체크박스 선택**: 다중 선택을 통한 일괄 삭제
- **실시간 검증**: 중복 학번, 필수 필드 등 즉시 확인

#### ⏰ 시간 슬롯 관리
- **우선순위별 시간 설정**: 12개 우선순위 그룹별 배정 시간
- **일정 생성/수정/삭제**: 새로운 배정 일정 관리
- **활성 일정 설정**: 현재 진행 중인 배정 일정 선택

#### ℹ️ 관리자 정보 관리
- **연락처 정보 설정**: 이름, 전화번호, 이메일, 학과, 직책
- **로그인 페이지 연동**: 입력한 정보가 자동으로 로그인 페이지에 표시
- **실시간 미리보기**: 변경사항 즉시 확인

### 🔐 보안 기능 (강화)
- **🛡️ bcrypt 비밀번호 해싱**: 안전한 비밀번호 저장
- **🍪 토큰 헤더 전송**: XSS/CSRF 취약점 최소화
- **🚫 민감정보 로깅 차단**: 프로덕션에서 개인정보 보호
- **🔑 서버 인증 확인**: 클라이언트 조작 불가능한 서버 검증
- **⚡ 즉시 로그아웃**: 안전한 세션 종료
- **👤 관리자 권한 분리**: 일반 사용자와 관리자 권한 구분

### 📱 반응형 디자인
- **모바일 최적화**: 모든 기능이 모바일에서 완벽 작동
- **태블릿 지원**: 중간 크기 화면에 최적화된 레이아웃
- **데스크톱 버전**: 넓은 화면을 활용한 효율적 인터페이스

## 🎯 우선순위 시스템

시스템은 12개의 우선순위 그룹으로 사용자를 분류합니다:

1. **1순위**: 수료생 - 15:00부터 접근
2. **2~11순위**: 각자 지정된 시간 + 15:00 이후 추가 접근
3. **12순위**: 기타 - 15:00부터 접근

이 시스템을 통해 공정한 좌석 배정과 효율적인 자원 관리가 가능합니다.

## 🚀 배포 환경

### 프로덕션 URL
- **프론트엔드**: https://seat-management.vercel.app
- **백엔드**: https://port-0-seat-management-mcdii4ecc60f3aad.sel5.cloudtype.app

### 환경 설정
각 배포 환경에서는 다음 환경변수들이 설정되어야 합니다:

**백엔드 (CloudType)**:
```
MONGO_URI=mongodb+srv://...
JWT_SECRET=minimum_32_characters_secret_key
JWT_EXPIRE=30d
JWT_COOKIE_EXPIRE=30
PORT=5001
NODE_ENV=production
```

**프론트엔드 (Vercel)**:
```
NEXT_PUBLIC_API_URL=https://port-0-seat-management-mcdii4ecc60f3aad.sel5.cloudtype.app/api
```

### 🤖 서버 Keep-Alive 시스템

CloudType 무료 티어의 자동 슬립 문제를 해결하기 위한 **다중 Keep-Alive 시스템**:

#### 1. GitHub Actions (3분 간격) 🟢
- 자동으로 서버 상태 확인 및 Wake-up
- GitHub 저장소에서 자동 실행

#### 2. 클라이언트 자동 Wake-up 🟢
- 사용자가 사이트 접속 시 자동으로 서버 깨우기
- 탭 활성화 시 재시도
- 4분마다 자동 Keep-alive ping

#### 3. API 호출 전 Wake-up 🟢
- 중요한 API 호출 전 서버 상태 확인
- 자동 재시도 로직 (3-5회)

#### 💡 권장 설정
무료로 사용하려면:
1. **GitHub Actions** (필수) - 가장 안정적
2. **클라이언트 Wake-up** (자동) - 사용자 경험 향상
3. **API Wake-up** (자동) - 요청 실패 방지

## 🔧 개발자 가이드

### 새 사용자 추가 시
1. **CSV 업로드**: 관리자 페이지에서 일괄 등록
2. **초기 비밀번호**: 자동으로 "sg1234" 할당
3. **사용자 안내**: 첫 로그인 후 비밀번호 변경 권장

### 비밀번호 정책
- **최소 길이**: 6자리 이상
- **해시화**: bcrypt 자동 처리
- **초기값**: "sg1234" (모든 사용자 공통)

### 보안 고려사항
- **토큰 관리**: Authorization 헤더 사용
- **환경변수**: JWT_SECRET은 최소 32자리 이상
- **로깅**: 프로덕션에서 민감정보 출력 금지
- **CORS**: 허용된 도메인만 접근 가능

## 📊 보안 강화 전후 비교

| 항목 | 기존 시스템 | 보안 강화 시스템 |
|------|-------------|------------------|
| 인증 방식 | 학번 + 이름 | 학번 + bcrypt 비밀번호 |
| 토큰 저장 | localStorage | Authorization 헤더 |
| 인증 확인 | 클라이언트 | 서버 API (/auth/me) |
| XSS 방어 | ❌ | ✅ (헤더 전송) |
| CSRF 방어 | ❌ | ✅ (헤더 전송) |
| 민감정보 로깅 | 모든 환경 | 개발환경만 |
| 로그아웃 | 토큰 삭제 | 클라이언트 토큰 제거 |
| 비밀번호 변경 | ❌ | ✅ (즉시 변경) |

## 👨‍💻 개발자

**최재호** (Jaeho Choi) AI finLab
- 서강대학교 경제학과 대학원 연구실 자리 배정 시스템 개발
- 보안 강화 및 사용자 경험 개선
- Email: wogh1217@sogang.ac.kr

## 📄 라이센스

이 프로젝트는 MIT 라이센스를 따릅니다.

---

**🔐 보안이 강화된 안전한 연구실 자리 배정 시스템입니다.**
